<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pasugo Admin Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      /* ══════════ VARIABLES ══════════ */
      :root {
        --primary: #ffc107;
        --primary-dark: #e6ac00;
        --sidebar-bg: #1a1a2e;
        --sidebar-active: #16213e;
        --sidebar-text: #a0aec0;
        --sidebar-text-active: #fff;
        --bg: #f4f6f9;
        --card-bg: #fff;
        --text: #2d3748;
        --text-light: #718096;
        --success: #48bb78;
        --danger: #f56565;
        --info: #4299e1;
        --warning: #ed8936;
        --border: #e2e8f0;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        --radius: 12px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        min-height: 100vh;
      }

      /* ══════════ SIDEBAR ══════════ */
      .sidebar {
        width: 260px;
        background: var(--sidebar-bg);
        color: var(--sidebar-text);
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 100;
        transition: transform 0.3s;
      }
      .sidebar-brand {
        padding: 24px 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }
      .sidebar-brand .logo {
        width: 38px;
        height: 38px;
        background: var(--primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 18px;
        color: #1a1a2e;
      }
      .sidebar-brand span {
        font-weight: 600;
        font-size: 18px;
        color: #fff;
      }

      .sidebar-nav {
        flex: 1;
        padding: 16px 0;
        overflow-y: auto;
      }
      .sidebar-nav .nav-label {
        padding: 8px 20px 6px;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(255, 255, 255, 0.3);
      }
      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 11px 20px;
        font-size: 14px;
        color: var(--sidebar-text);
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
        text-decoration: none;
      }
      .nav-item:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
      }
      .nav-item.active {
        background: var(--sidebar-active);
        color: var(--sidebar-text-active);
        border-left-color: var(--primary);
      }
      .nav-item i {
        width: 20px;
        text-align: center;
        font-size: 15px;
      }

      .sidebar-footer {
        padding: 16px 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
        font-size: 13px;
      }
      .sidebar-footer .admin-name {
        color: #fff;
        font-weight: 500;
      }
      .sidebar-footer .admin-role {
        color: var(--sidebar-text);
        font-size: 11px;
      }

      /* ══════════ MAIN ══════════ */
      .main-content {
        margin-left: 260px;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Top bar */
      .topbar {
        background: var(--card-bg);
        padding: 16px 32px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 50;
      }
      .topbar h2 {
        font-size: 20px;
        font-weight: 600;
      }
      .topbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .topbar-right .badge {
        background: var(--primary);
        color: #1a1a2e;
        font-size: 11px;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 20px;
      }

      .page-content {
        padding: 28px 32px;
        flex: 1;
      }

      /* ══════════ CARDS ══════════ */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 28px;
      }
      .stat-card {
        background: var(--card-bg);
        border-radius: var(--radius);
        padding: 22px;
        box-shadow: var(--shadow);
        display: flex;
        align-items: flex-start;
        gap: 16px;
        transition: transform 0.15s;
      }
      .stat-card:hover {
        transform: translateY(-2px);
      }
      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;
      }
      .stat-icon.yellow {
        background: #fff8e1;
        color: #e6ac00;
      }
      .stat-icon.green {
        background: #e6ffed;
        color: #38a169;
      }
      .stat-icon.blue {
        background: #ebf5ff;
        color: #3182ce;
      }
      .stat-icon.red {
        background: #fff5f5;
        color: #e53e3e;
      }
      .stat-icon.purple {
        background: #faf5ff;
        color: #805ad5;
      }
      .stat-info h4 {
        font-size: 13px;
        font-weight: 400;
        color: var(--text-light);
      }
      .stat-info .number {
        font-size: 26px;
        font-weight: 700;
        margin-top: 2px;
      }
      .stat-info .sub {
        font-size: 12px;
        color: var(--text-light);
        margin-top: 2px;
      }

      /* ══════════ TABLE ══════════ */
      .card {
        background: var(--card-bg);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 24px;
      }
      .card-header {
        padding: 18px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border);
      }
      .card-header h3 {
        font-size: 16px;
        font-weight: 600;
      }
      .card-body {
        padding: 0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      thead th {
        text-align: left;
        padding: 12px 18px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-light);
        border-bottom: 1px solid var(--border);
        background: #fafbfc;
      }
      tbody td {
        padding: 14px 18px;
        font-size: 14px;
        border-bottom: 1px solid var(--border);
        vertical-align: middle;
      }
      tbody tr:last-child td {
        border-bottom: none;
      }
      tbody tr:hover {
        background: #f8f9fb;
      }

      /* Status badges */
      .badge-status {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
      }
      .badge-available {
        background: #e6ffed;
        color: #22543d;
      }
      .badge-busy {
        background: #fff8e1;
        color: #744210;
      }
      .badge-offline {
        background: #f0f0f0;
        color: #666;
      }
      .badge-suspended {
        background: #fff5f5;
        color: #9b2c2c;
      }
      .badge-completed {
        background: #e6ffed;
        color: #22543d;
      }
      .badge-pending {
        background: #fff8e1;
        color: #744210;
      }
      .badge-in_progress {
        background: #ebf5ff;
        color: #2b6cb0;
      }
      .badge-cancelled {
        background: #fff5f5;
        color: #9b2c2c;
      }
      .badge-assigned {
        background: #faf5ff;
        color: #553c9a;
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        font-family: inherit;
        text-decoration: none;
      }
      .btn-primary {
        background: var(--primary);
        color: #1a1a2e;
      }
      .btn-primary:hover {
        background: var(--primary-dark);
      }
      .btn-danger {
        background: #fff5f5;
        color: #e53e3e;
      }
      .btn-danger:hover {
        background: #fed7d7;
      }
      .btn-sm {
        padding: 5px 10px;
        font-size: 12px;
      }
      .btn-outline {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }
      .btn-outline:hover {
        background: var(--bg);
      }

      /* Search */
      .search-box {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--bg);
        border-radius: 8px;
        padding: 8px 14px;
        border: 1px solid var(--border);
      }
      .search-box input {
        border: none;
        background: transparent;
        outline: none;
        font-size: 14px;
        font-family: inherit;
        color: var(--text);
        width: 240px;
      }
      .search-box i {
        color: var(--text-light);
        font-size: 14px;
      }

      /* ══════════ SECTIONS (toggle visibility) ══════════ */
      .page-section {
        display: none;
      }
      .page-section.active {
        display: block;
      }

      /* ══════════ CHARTS placeholder ══════════ */
      .chart-container {
        padding: 24px;
        min-height: 200px;
        display: flex;
        flex-direction: column;
      }
      .chart-bar-group {
        display: flex;
        align-items: flex-end;
        gap: 6px;
        height: 160px;
        padding-top: 12px;
      }
      .chart-bar {
        flex: 1;
        background: var(--primary);
        border-radius: 4px 4px 0 0;
        min-width: 12px;
        position: relative;
        transition: height 0.4s ease;
      }
      .chart-bar:hover {
        opacity: 0.85;
      }
      .chart-bar .tooltip {
        display: none;
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: var(--sidebar-bg);
        color: #fff;
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 6px;
        white-space: nowrap;
        margin-bottom: 4px;
      }
      .chart-bar:hover .tooltip {
        display: block;
      }
      .chart-labels {
        display: flex;
        gap: 6px;
        margin-top: 6px;
      }
      .chart-labels span {
        flex: 1;
        text-align: center;
        font-size: 10px;
        color: var(--text-light);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* ══════════ DETAIL PANEL ══════════ */
      .detail-panel {
        position: fixed;
        top: 0;
        right: -540px;
        bottom: 0;
        width: 540px;
        background: var(--card-bg);
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.12);
        z-index: 200;
        transition: right 0.3s ease;
        display: flex;
        flex-direction: column;
      }
      .detail-panel.open {
        right: 0;
      }
      .detail-panel-header {
        padding: 20px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border);
      }
      .detail-panel-header h3 {
        font-size: 18px;
      }
      .detail-panel-body {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
      }
      .detail-panel .close-btn {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: var(--text-light);
      }

      /* Info rows */
      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 24px;
      }
      .info-item label {
        font-size: 12px;
        color: var(--text-light);
        display: block;
        margin-bottom: 2px;
      }
      .info-item .val {
        font-size: 15px;
        font-weight: 600;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.3);
        z-index: 190;
        display: none;
      }
      .overlay.visible {
        display: block;
      }

      /* Loading */
      .spinner {
        text-align: center;
        padding: 40px;
        color: var(--text-light);
      }

      /* ══════════ LOGIN OVERLAY ══════════ */
      .login-overlay {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }
      .login-box {
        background: #fff;
        border-radius: 16px;
        padding: 48px 40px;
        width: 400px;
        max-width: 90vw;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        text-align: center;
      }
      .login-box .brand-icon {
        width: 64px;
        height: 64px;
        background: var(--primary);
        border-radius: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: 700;
        color: #1a1a2e;
        margin-bottom: 20px;
      }
      .login-box h2 {
        font-size: 22px;
        margin-bottom: 6px;
      }
      .login-box p {
        color: var(--text-light);
        font-size: 14px;
        margin-bottom: 28px;
      }
      .login-box .form-group {
        text-align: left;
        margin-bottom: 18px;
      }
      .login-box label {
        font-size: 13px;
        font-weight: 500;
        display: block;
        margin-bottom: 6px;
      }
      .login-box input {
        width: 100%;
        padding: 11px 14px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        outline: none;
        transition: border-color 0.2s;
      }
      .login-box input:focus {
        border-color: var(--primary);
      }
      .login-box .btn-login {
        width: 100%;
        padding: 12px;
        background: var(--primary);
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        font-family: inherit;
        color: #1a1a2e;
        margin-top: 8px;
      }
      .login-box .btn-login:hover {
        background: var(--primary-dark);
      }
      .login-box .error-msg {
        color: var(--danger);
        font-size: 13px;
        margin-top: 12px;
        display: none;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
        }
        .sidebar.open {
          transform: translateX(0);
        }
        .main-content {
          margin-left: 0;
        }
        .detail-panel {
          width: 100%;
          right: -100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- ═══════ LOGIN SCREEN ═══════ -->
    <div class="login-overlay" id="loginOverlay">
      <div class="login-box">
        <div class="brand-icon">P</div>
        <h2>Pasugo Admin</h2>
        <p>Sign in to your admin dashboard</p>
        <form id="loginForm" onsubmit="return handleLogin(event);">
          <div class="form-group">
            <label>Email</label>
            <input
              type="email"
              id="loginEmail"
              placeholder="admin@pasugo.com"
              required
            />
          </div>
          <div class="form-group">
            <label>Password</label>
            <input
              type="password"
              id="loginPassword"
              placeholder="••••••••"
              required
            />
          </div>
          <button type="submit" class="btn-login" id="loginBtn">Sign In</button>
          <div class="error-msg" id="loginError"></div>
        </form>
      </div>
    </div>

    <!-- ═══════ SIDEBAR ═══════ -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-brand">
        <div class="logo">P</div>
        <span>Pasugo Admin</span>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-label">Main</div>
        <a
          class="nav-item active"
          data-page="dashboard"
          onclick="showPage('dashboard')"
        >
          <i class="fas fa-chart-pie"></i> Dashboard
        </a>
        <a class="nav-item" data-page="riders" onclick="showPage('riders')">
          <i class="fas fa-motorcycle"></i> Rider Management
        </a>
        <a class="nav-item" data-page="requests" onclick="showPage('requests')">
          <i class="fas fa-clipboard-list"></i> Requests
        </a>

        <div class="nav-label" style="margin-top: 18px">Analytics</div>
        <a class="nav-item" data-page="revenue" onclick="showPage('revenue')">
          <i class="fas fa-peso-sign"></i> Revenue
        </a>
        <a
          class="nav-item"
          data-page="customers"
          onclick="showPage('customers')"
        >
          <i class="fas fa-users"></i> Customers
        </a>
      </nav>
      <div class="sidebar-footer">
        <div class="admin-name" id="adminName">Admin</div>
        <div class="admin-role" id="adminRole">Super Admin</div>
        <a
          class="nav-item"
          style="padding: 8px 0; margin-top: 8px; border: none"
          onclick="logout()"
        >
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </div>
    </aside>

    <!-- ═══════ MAIN CONTENT ═══════ -->
    <div class="main-content" id="mainContent">
      <!-- Top bar -->
      <div class="topbar">
        <div style="display: flex; align-items: center; gap: 12px">
          <button
            class="btn btn-outline"
            style="display: none"
            id="menuToggle"
            onclick="toggleSidebar()"
          >
            <i class="fas fa-bars"></i>
          </button>
          <h2 id="pageTitle">Dashboard</h2>
        </div>
        <div class="topbar-right">
          <span class="badge">70/30 Split</span>
          <span
            style="font-size: 13px; color: var(--text-light)"
            id="todayDate"
          ></span>
        </div>
      </div>

      <div class="page-content">
        <!-- ═══════════════════════════════════════════════ -->
        <!--  DASHBOARD PAGE                                -->
        <!-- ═══════════════════════════════════════════════ -->
        <section class="page-section active" id="page-dashboard">
          <div class="stats-grid" id="summaryCards">
            <div class="stat-card"><div class="spinner">Loading...</div></div>
          </div>

          <!-- Today's snapshot -->
          <div
            class="stats-grid"
            id="todayCards"
            style="margin-bottom: 28px"
          ></div>

          <!-- Recent requests -->
          <div class="card">
            <div class="card-header">
              <h3>Recent Requests</h3>
            </div>
            <div class="card-body">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Service Fee</th>
                    <th>Admin Share</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="dashRecentRequests">
                  <tr>
                    <td colspan="6" class="spinner">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ═══════════════════════════════════════════════ -->
        <!--  RIDERS PAGE                                   -->
        <!-- ═══════════════════════════════════════════════ -->
        <section class="page-section" id="page-riders">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
              flex-wrap: wrap;
              gap: 12px;
            "
          >
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input
                type="text"
                id="riderSearch"
                placeholder="Search riders..."
                oninput="debouncedLoadRiders()"
              />
            </div>
            <div style="display: flex; gap: 8px">
              <select
                id="riderStatusFilter"
                class="btn btn-outline"
                style="padding: 8px 12px"
                onchange="loadRiders()"
              >
                <option value="">All Statuses</option>
                <option value="available">Available</option>
                <option value="busy">Busy</option>
                <option value="offline">Offline</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <table>
                <thead>
                  <tr>
                    <th>Rider</th>
                    <th>Status</th>
                    <th>Today</th>
                    <th>Total Deliveries</th>
                    <th>Total Fee</th>
                    <th>Rider (70%)</th>
                    <th>Admin (30%)</th>
                    <th>Rating</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ridersTableBody">
                  <tr>
                    <td colspan="9" class="spinner">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div
            id="ridersPagination"
            style="
              display: flex;
              justify-content: center;
              gap: 8px;
              margin-top: 16px;
            "
          ></div>
        </section>

        <!-- ═══════════════════════════════════════════════ -->
        <!--  REQUESTS PAGE                                 -->
        <!-- ═══════════════════════════════════════════════ -->
        <section class="page-section" id="page-requests">
          <div style="display: flex; gap: 8px; margin-bottom: 20px">
            <select
              id="reqStatusFilter"
              class="btn btn-outline"
              style="padding: 8px 12px"
              onchange="loadRequests()"
            >
              <option value="">All Statuses</option>
              <option value="pending">Pending</option>
              <option value="assigned">Assigned</option>
              <option value="in_progress">In Progress</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          <div class="card">
            <div class="card-body">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Item Cost</th>
                    <th>Service Fee</th>
                    <th>Total</th>
                    <th>Admin (30%)</th>
                    <th>Created</th>
                  </tr>
                </thead>
                <tbody id="requestsTableBody">
                  <tr>
                    <td colspan="8" class="spinner">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div
            id="requestsPagination"
            style="
              display: flex;
              justify-content: center;
              gap: 8px;
              margin-top: 16px;
            "
          ></div>
        </section>

        <!-- ═══════════════════════════════════════════════ -->
        <!--  REVENUE PAGE                                  -->
        <!-- ═══════════════════════════════════════════════ -->
        <section class="page-section" id="page-revenue">
          <div
            style="
              display: flex;
              gap: 12px;
              margin-bottom: 20px;
              align-items: center;
            "
          >
            <label style="font-size: 14px; font-weight: 500">Period:</label>
            <select
              id="revenueDays"
              class="btn btn-outline"
              style="padding: 8px 12px"
              onchange="loadRevenue()"
            >
              <option value="7">Last 7 days</option>
              <option value="30" selected>Last 30 days</option>
              <option value="90">Last 90 days</option>
              <option value="365">Last year</option>
            </select>
          </div>

          <div class="stats-grid" id="revenueSummary"></div>

          <div class="card">
            <div class="card-header"><h3>Daily Revenue Trend</h3></div>
            <div class="chart-container">
              <div class="chart-bar-group" id="revenueChart"></div>
              <div class="chart-labels" id="revenueLabels"></div>
            </div>
          </div>

          <div class="card" style="margin-top: 20px">
            <div class="card-header"><h3>Service Type Breakdown</h3></div>
            <div class="card-body" style="padding: 20px">
              <div id="serviceTypeBreakdown"></div>
            </div>
          </div>
        </section>

        <!-- ═══════════════════════════════════════════════ -->
        <!--  CUSTOMERS PAGE                                -->
        <!-- ═══════════════════════════════════════════════ -->
        <section class="page-section" id="page-customers">
          <div class="stats-grid" id="customerSummary"></div>

          <div class="card">
            <div class="card-header">
              <h3>Daily Sign-ups (Last 30 Days)</h3>
            </div>
            <div class="chart-container">
              <div class="chart-bar-group" id="signupChart"></div>
              <div class="chart-labels" id="signupLabels"></div>
            </div>
          </div>

          <div class="card" style="margin-top: 20px">
            <div class="card-header"><h3>Top Customers</h3></div>
            <div class="card-body">
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Requests</th>
                    <th>Total Spent</th>
                  </tr>
                </thead>
                <tbody id="topCustomersBody">
                  <tr>
                    <td colspan="4" class="spinner">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
      <!-- /page-content -->
    </div>
    <!-- /main-content -->

    <!-- ═══════ RIDER DETAIL PANEL ═══════ -->
    <div class="overlay" id="overlay" onclick="closeDetail()"></div>
    <div class="detail-panel" id="detailPanel">
      <div class="detail-panel-header">
        <h3 id="detailTitle">Rider Details</h3>
        <button class="close-btn" onclick="closeDetail()">&times;</button>
      </div>
      <div class="detail-panel-body" id="detailBody"></div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <script>
      // ── Config ──────────────────────────────────────────────────────────────
      const API = "https://pasugo.onrender.com/api";
      let TOKEN = localStorage.getItem("admin_token") || "";

      // ── Helpers ─────────────────────────────────────────────────────────────
      function headers() {
        return {
          "Content-Type": "application/json",
          Authorization: `Bearer ${TOKEN}`,
        };
      }
      async function api(path, opts = {}) {
        const res = await fetch(`${API}${path}`, {
          headers: headers(),
          ...opts,
        });
        if (res.status === 401 || res.status === 403) {
          logout();
          throw new Error("Unauthorized");
        }
        return res.json();
      }
      function peso(n) {
        return (
          "₱" +
          Number(n || 0).toLocaleString("en-PH", { minimumFractionDigits: 2 })
        );
      }
      function short(dt) {
        if (!dt) return "—";
        const d = new Date(dt);
        return d.toLocaleDateString("en-PH", {
          month: "short",
          day: "numeric",
          year: "numeric",
        });
      }
      function shortTime(dt) {
        if (!dt) return "—";
        const d = new Date(dt);
        return (
          d.toLocaleDateString("en-PH", { month: "short", day: "numeric" }) +
          " " +
          d.toLocaleTimeString("en-PH", { hour: "2-digit", minute: "2-digit" })
        );
      }
      function statusBadge(s) {
        return `<span class="badge-status badge-${s || "offline"}">${(s || "—").replace(/_/g, " ")}</span>`;
      }

      // ── Login ───────────────────────────────────────────────────────────────
      async function handleLogin(e) {
        e.preventDefault();
        const btn = document.getElementById("loginBtn");
        const err = document.getElementById("loginError");
        btn.textContent = "Signing in...";
        btn.disabled = true;
        err.style.display = "none";

        try {
          const res = await fetch(`${API}/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email: document.getElementById("loginEmail").value.trim(),
              password: document.getElementById("loginPassword").value,
            }),
          });
          const data = await res.json();
          if (!res.ok)
            throw new Error(data.detail || data.message || "Login failed");

          // Login response nests everything under data.data
          const loginData = data.data || data;

          // Check user type
          if (loginData.user?.user_type !== "admin") {
            throw new Error("Access denied. Admin account required.");
          }

          TOKEN = loginData.access_token;
          localStorage.setItem("admin_token", TOKEN);
          document.getElementById("loginOverlay").style.display = "none";
          initDashboard();
        } catch (ex) {
          err.textContent = ex.message;
          err.style.display = "block";
        }
        btn.textContent = "Sign In";
        btn.disabled = false;
        return false;
      }

      function logout() {
        TOKEN = "";
        localStorage.removeItem("admin_token");
        location.reload();
      }

      // ── Init ────────────────────────────────────────────────────────────────
      async function initDashboard() {
        document.getElementById("todayDate").textContent =
          new Date().toLocaleDateString("en-PH", {
            weekday: "long",
            month: "long",
            day: "numeric",
            year: "numeric",
          });

        try {
          const me = await api("/admin/me");
          if (me.success) {
            document.getElementById("adminName").textContent =
              me.data.full_name;
            document.getElementById("adminRole").textContent =
              me.data.role.replace(/_/g, " ");
          }
        } catch (e) {
          console.error(e);
        }

        loadDashboard();
      }

      // ── Page switching ──────────────────────────────────────────────────────
      function showPage(page) {
        document
          .querySelectorAll(".page-section")
          .forEach((s) => s.classList.remove("active"));
        document
          .querySelectorAll(".nav-item[data-page]")
          .forEach((n) => n.classList.remove("active"));

        const sec = document.getElementById(`page-${page}`);
        if (sec) sec.classList.add("active");
        const nav = document.querySelector(`.nav-item[data-page="${page}"]`);
        if (nav) nav.classList.add("active");

        const titles = {
          dashboard: "Dashboard",
          riders: "Rider Management",
          requests: "Requests",
          revenue: "Revenue Analytics",
          customers: "Customer Analytics",
        };
        document.getElementById("pageTitle").textContent = titles[page] || page;

        if (page === "dashboard") loadDashboard();
        else if (page === "riders") loadRiders();
        else if (page === "requests") loadRequests();
        else if (page === "revenue") loadRevenue();
        else if (page === "customers") loadCustomers();
      }

      // ═══════════════════════════════════════════════════════════════════════
      //  DASHBOARD
      // ═══════════════════════════════════════════════════════════════════════
      async function loadDashboard() {
        try {
          const res = await api("/admin/dashboard/summary");
          const d = res.data;

          document.getElementById("summaryCards").innerHTML = `
        <div class="stat-card">
          <div class="stat-icon blue"><i class="fas fa-motorcycle"></i></div>
          <div class="stat-info"><h4>Total Riders</h4><div class="number">${d.total_riders}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon purple"><i class="fas fa-users"></i></div>
          <div class="stat-info"><h4>Customers</h4><div class="number">${d.total_customers}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
          <div class="stat-info"><h4>Completed</h4><div class="number">${d.completed_requests}</div>
          <div class="sub">${d.total_requests} total requests</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon yellow"><i class="fas fa-peso-sign"></i></div>
          <div class="stat-info"><h4>Total Service Fees</h4><div class="number">${peso(d.total_service_fee)}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon red"><i class="fas fa-building-columns"></i></div>
          <div class="stat-info"><h4>Admin Share (30%)</h4><div class="number">${peso(d.admin_share)}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green"><i class="fas fa-motorcycle"></i></div>
          <div class="stat-info"><h4>Rider Share (70%)</h4><div class="number">${peso(d.rider_share)}</div></div>
        </div>
      `;

          document.getElementById("todayCards").innerHTML = `
        <div class="stat-card" style="border-left:4px solid var(--primary);">
          <div class="stat-info"><h4>Today's Requests</h4><div class="number">${d.today.requests}</div></div>
        </div>
        <div class="stat-card" style="border-left:4px solid var(--success);">
          <div class="stat-info"><h4>Today Completed</h4><div class="number">${d.today.completed}</div></div>
        </div>
        <div class="stat-card" style="border-left:4px solid var(--info);">
          <div class="stat-info"><h4>Today Revenue</h4><div class="number">${peso(d.today.revenue)}</div></div>
        </div>
        <div class="stat-card" style="border-left:4px solid var(--danger);">
          <div class="stat-info"><h4>Today Admin Cut</h4><div class="number">${peso(d.today.admin_share)}</div></div>
        </div>
      `;

          // Recent requests
          const rr = await api("/admin/requests?per_page=8");
          document.getElementById("dashRecentRequests").innerHTML =
            (rr.data || [])
              .map(
                (r) => `
        <tr>
          <td>#${r.request_id}</td>
          <td>${r.service_type || "—"}</td>
          <td>${statusBadge(r.status)}</td>
          <td>${peso(r.service_fee)}</td>
          <td>${peso(r.admin_share)}</td>
          <td>${short(r.created_at)}</td>
        </tr>
      `,
              )
              .join("") ||
            '<tr><td colspan="6" style="text-align:center;padding:20px;">No requests yet</td></tr>';
        } catch (e) {
          console.error("Dashboard load error:", e);
          document.getElementById("summaryCards").innerHTML =
            `<div class="stat-card"><div class="spinner">Failed to load dashboard</div></div>`;
        }
      }

      // ═══════════════════════════════════════════════════════════════════════
      //  RIDERS
      // ═══════════════════════════════════════════════════════════════════════
      let ridersPage = 1;
      let _riderDebounce;
      function debouncedLoadRiders() {
        clearTimeout(_riderDebounce);
        _riderDebounce = setTimeout(() => loadRiders(), 350);
      }

      async function loadRiders(page) {
        if (page) ridersPage = page;
        const search = document.getElementById("riderSearch").value.trim();
        const st = document.getElementById("riderStatusFilter").value;
        let url = `/admin/riders?page=${ridersPage}&per_page=15`;
        if (search) url += `&search=${encodeURIComponent(search)}`;
        if (st) url += `&status=${st}`;

        try {
          const res = await api(url);
          const riders = res.data || [];
          const pg = res.pagination || {};

          document.getElementById("ridersTableBody").innerHTML =
            riders
              .map(
                (r) => `
        <tr>
          <td>
            <div style="font-weight:600;">${r.full_name || "—"}</div>
            <div style="font-size:12px;color:var(--text-light);">${r.email || ""}</div>
          </td>
          <td>${statusBadge(r.status)}</td>
          <td style="font-weight:600;">${r.today_deliveries}</td>
          <td>${r.total_deliveries}</td>
          <td>${peso(r.total_service_fee)}</td>
          <td style="color:var(--success);font-weight:600;">${peso(r.rider_share)}</td>
          <td style="color:var(--danger);font-weight:600;">${peso(r.admin_share)}</td>
          <td>⭐ ${r.rating?.toFixed(1) || "0.0"}</td>
          <td>
            <button class="btn btn-sm btn-primary" onclick="openRiderDetail(${r.rider_id})">
              <i class="fas fa-eye"></i>
            </button>
            <button class="btn btn-sm btn-danger" onclick="deleteRider(${r.rider_id}, '${(r.full_name || "").replace(/'/g, "\\'")}')">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `,
              )
              .join("") ||
            '<tr><td colspan="9" style="text-align:center;padding:20px;">No riders found</td></tr>';

          // Pagination
          const totalPages = Math.ceil((pg.total || 0) / (pg.per_page || 15));
          let pHtml = "";
          for (let i = 1; i <= totalPages; i++) {
            pHtml += `<button class="btn btn-sm ${i === ridersPage ? "btn-primary" : "btn-outline"}" onclick="loadRiders(${i})">${i}</button>`;
          }
          document.getElementById("ridersPagination").innerHTML = pHtml;
        } catch (e) {
          console.error(e);
          document.getElementById("ridersTableBody").innerHTML =
            '<tr><td colspan="9" class="spinner">Error loading riders</td></tr>';
        }
      }

      // ── Rider Detail ────────────────────────────────────────────────────────
      async function openRiderDetail(riderId) {
        const panel = document.getElementById("detailPanel");
        const overlay = document.getElementById("overlay");
        document.getElementById("detailBody").innerHTML =
          '<div class="spinner">Loading rider details...</div>';
        panel.classList.add("open");
        overlay.classList.add("visible");

        try {
          const res = await api(`/admin/riders/${riderId}`);
          const r = res.data;

          // Also load location
          let locHtml = "";
          try {
            const locRes = await api(`/admin/riders/${riderId}/location`);
            const loc = locRes.data;
            if (loc.current) {
              locHtml = `
            <div style="margin-bottom:20px;">
              <h4 style="font-size:14px;margin-bottom:10px;"><i class="fas fa-map-marker-alt" style="color:var(--danger);"></i> Current Location</h4>
              <div class="info-grid">
                <div class="info-item"><label>Latitude</label><div class="val">${loc.current.latitude}</div></div>
                <div class="info-item"><label>Longitude</label><div class="val">${loc.current.longitude}</div></div>
                <div class="info-item"><label>Address</label><div class="val">${loc.current.address || "—"}</div></div>
                <div class="info-item"><label>Last Updated</label><div class="val">${shortTime(loc.current.created_at)}</div></div>
              </div>
              ${
                loc.history && loc.history.length > 1
                  ? `
                <details style="margin-top:8px;">
                  <summary style="cursor:pointer;font-size:13px;color:var(--info);">Location History (${loc.history.length} points)</summary>
                  <table style="margin-top:8px;font-size:12px;">
                    <thead><tr><th>Lat</th><th>Lng</th><th>Address</th><th>Time</th></tr></thead>
                    <tbody>
                      ${loc.history
                        .slice(0, 20)
                        .map(
                          (h) => `
                        <tr><td>${h.latitude.toFixed(6)}</td><td>${h.longitude.toFixed(6)}</td><td>${h.address || "—"}</td><td>${shortTime(h.created_at)}</td></tr>
                      `,
                        )
                        .join("")}
                    </tbody>
                  </table>
                </details>
              `
                  : ""
              }
            </div>
          `;
            }
          } catch (e) {
            console.log("No location data");
          }

          document.getElementById("detailTitle").textContent =
            r.full_name || "Rider Details";
          document.getElementById("detailBody").innerHTML = `
        <div class="info-grid">
          <div class="info-item"><label>Email</label><div class="val">${r.email || "—"}</div></div>
          <div class="info-item"><label>Phone</label><div class="val">${r.phone || "—"}</div></div>
          <div class="info-item"><label>Vehicle</label><div class="val">${r.vehicle_type || "—"} (${r.vehicle_plate || "—"})</div></div>
          <div class="info-item"><label>License</label><div class="val">${r.license_number || "—"}</div></div>
          <div class="info-item"><label>Status</label><div class="val">${statusBadge(r.status)}</div></div>
          <div class="info-item"><label>Rating</label><div class="val">⭐ ${r.rating?.toFixed(1) || "0.0"}</div></div>
          <div class="info-item"><label>GCash Name</label><div class="val">${r.gcash_name || "—"}</div></div>
          <div class="info-item"><label>GCash Number</label><div class="val">${r.gcash_number || "—"}</div></div>
          <div class="info-item"><label>Joined</label><div class="val">${short(r.created_at)}</div></div>
        </div>

        <!-- Revenue Summary -->
        <div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:12px;padding:20px;color:#fff;margin-bottom:20px;">
          <div style="font-size:13px;opacity:.7;margin-bottom:12px;">Revenue Summary (All Time)</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
            <div><div style="font-size:11px;opacity:.6;">Total Fee</div><div style="font-size:20px;font-weight:700;">${peso(r.total_service_fee)}</div></div>
            <div><div style="font-size:11px;opacity:.6;">Rider (70%)</div><div style="font-size:20px;font-weight:700;color:#48bb78;">${peso(r.rider_share)}</div></div>
            <div><div style="font-size:11px;opacity:.6;">Admin (30%)</div><div style="font-size:20px;font-weight:700;color:#ffc107;">${peso(r.admin_share)}</div></div>
          </div>
        </div>

        ${locHtml}

        <!-- Daily Breakdown -->
        ${
          r.daily_breakdown && r.daily_breakdown.length > 0
            ? `
          <h4 style="font-size:14px;margin-bottom:10px;">Daily Breakdown (Last 30 Days)</h4>
          <table style="font-size:13px;">
            <thead><tr><th>Date</th><th>Deliveries</th><th>Fee</th><th>Rider 70%</th><th>Admin 30%</th></tr></thead>
            <tbody>
              ${r.daily_breakdown
                .map(
                  (d) => `
                <tr>
                  <td>${short(d.date)}</td>
                  <td>${d.deliveries}</td>
                  <td>${peso(d.service_fee)}</td>
                  <td style="color:var(--success);">${peso(d.rider_share)}</td>
                  <td style="color:var(--danger);">${peso(d.admin_share)}</td>
                </tr>
              `,
                )
                .join("")}
            </tbody>
          </table>
        `
            : '<p style="color:var(--text-light);font-size:13px;">No deliveries in the last 30 days</p>'
        }

        <!-- Recent Deliveries -->
        ${
          r.recent_deliveries && r.recent_deliveries.length > 0
            ? `
          <h4 style="font-size:14px;margin:20px 0 10px;">Recent Deliveries</h4>
          <table style="font-size:13px;">
            <thead><tr><th>ID</th><th>Type</th><th>Fee</th><th>Admin Cut</th><th>Date</th></tr></thead>
            <tbody>
              ${r.recent_deliveries
                .slice(0, 20)
                .map(
                  (d) => `
                <tr>
                  <td>#${d.request_id}</td>
                  <td>${d.service_type || "—"}</td>
                  <td>${peso(d.service_fee)}</td>
                  <td>${peso(d.admin_share)}</td>
                  <td>${shortTime(d.completed_at)}</td>
                </tr>
              `,
                )
                .join("")}
            </tbody>
          </table>
        `
            : ""
        }
      `;
        } catch (e) {
          console.error(e);
          document.getElementById("detailBody").innerHTML =
            '<div class="spinner">Error loading rider details</div>';
        }
      }

      function closeDetail() {
        document.getElementById("detailPanel").classList.remove("open");
        document.getElementById("overlay").classList.remove("visible");
      }

      async function deleteRider(riderId, name) {
        if (
          !confirm(
            `Suspend rider "${name}"?\n\nThis will deactivate their account and suspend their rider status. Active deliveries must be completed first.`,
          )
        )
          return;

        try {
          const res = await api(`/admin/riders/${riderId}`, {
            method: "DELETE",
          });
          alert(res.message || "Rider suspended");
          loadRiders();
        } catch (e) {
          try {
            const data = await e.json?.();
            alert(data?.detail || "Failed");
          } catch (_) {
            alert("Failed to suspend rider");
          }
        }
      }

      // ═══════════════════════════════════════════════════════════════════════
      //  REQUESTS
      // ═══════════════════════════════════════════════════════════════════════
      let requestsPage = 1;
      async function loadRequests(page) {
        if (page) requestsPage = page;
        const st = document.getElementById("reqStatusFilter").value;
        let url = `/admin/requests?page=${requestsPage}&per_page=20`;
        if (st) url += `&status=${st}`;

        try {
          const res = await api(url);
          const reqs = res.data || [];
          const pg = res.pagination || {};

          document.getElementById("requestsTableBody").innerHTML =
            reqs
              .map(
                (r) => `
        <tr>
          <td>#${r.request_id}</td>
          <td>${r.service_type || "—"}</td>
          <td>${statusBadge(r.status)}</td>
          <td>${peso(r.item_cost)}</td>
          <td>${peso(r.service_fee)}</td>
          <td>${peso(r.total_amount)}</td>
          <td style="color:var(--danger);font-weight:600;">${peso(r.admin_share)}</td>
          <td>${short(r.created_at)}</td>
        </tr>
      `,
              )
              .join("") ||
            '<tr><td colspan="8" style="text-align:center;padding:20px;">No requests found</td></tr>';

          const totalPages = Math.ceil((pg.total || 0) / (pg.per_page || 20));
          let pHtml = "";
          for (let i = 1; i <= totalPages; i++) {
            pHtml += `<button class="btn btn-sm ${i === requestsPage ? "btn-primary" : "btn-outline"}" onclick="loadRequests(${i})">${i}</button>`;
          }
          document.getElementById("requestsPagination").innerHTML = pHtml;
        } catch (e) {
          console.error(e);
        }
      }

      // ═══════════════════════════════════════════════════════════════════════
      //  REVENUE
      // ═══════════════════════════════════════════════════════════════════════
      async function loadRevenue() {
        const days = document.getElementById("revenueDays").value;
        try {
          const [revRes, stRes] = await Promise.all([
            api(`/admin/analytics/revenue?days=${days}`),
            api("/admin/analytics/service-types"),
          ]);

          const data = revRes.data || [];
          const totalFee = data.reduce((s, d) => s + d.service_fee, 0);
          const totalAdmin = data.reduce((s, d) => s + d.admin_share, 0);
          const totalRider = data.reduce((s, d) => s + d.rider_share, 0);
          const totalDel = data.reduce((s, d) => s + d.deliveries, 0);

          document.getElementById("revenueSummary").innerHTML = `
        <div class="stat-card">
          <div class="stat-icon yellow"><i class="fas fa-peso-sign"></i></div>
          <div class="stat-info"><h4>Total Service Fees</h4><div class="number">${peso(totalFee)}</div><div class="sub">${totalDel} deliveries</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon red"><i class="fas fa-building-columns"></i></div>
          <div class="stat-info"><h4>Admin Revenue (30%)</h4><div class="number">${peso(totalAdmin)}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green"><i class="fas fa-motorcycle"></i></div>
          <div class="stat-info"><h4>Rider Payouts (70%)</h4><div class="number">${peso(totalRider)}</div></div>
        </div>
      `;

          // Chart
          const maxFee = Math.max(...data.map((d) => d.service_fee), 1);
          document.getElementById("revenueChart").innerHTML = data
            .map((d) => {
              const h = Math.max((d.service_fee / maxFee) * 140, 4);
              return `<div class="chart-bar" style="height:${h}px;"><span class="tooltip">${d.date}: ${peso(d.service_fee)} (${d.deliveries} del.)</span></div>`;
            })
            .join("");
          document.getElementById("revenueLabels").innerHTML = data
            .map((d, i) => {
              const show =
                data.length <= 14 || i % Math.ceil(data.length / 14) === 0;
              return `<span>${show ? d.date.slice(5) : ""}</span>`;
            })
            .join("");

          // Service types
          const sts = stRes.data || [];
          document.getElementById("serviceTypeBreakdown").innerHTML =
            sts.length > 0
              ? `
        <table style="width:100%;">
          <thead><tr><th>Service Type</th><th>Completed</th><th>Total Service Fee</th><th>Admin (30%)</th></tr></thead>
          <tbody>${sts
            .map(
              (s) => `
            <tr>
              <td style="text-transform:capitalize;font-weight:500;">${s.service_type}</td>
              <td>${s.count}</td>
              <td>${peso(s.total_fee)}</td>
              <td style="color:var(--danger);font-weight:600;">${peso(s.total_fee * 0.3)}</td>
            </tr>
          `,
            )
            .join("")}</tbody>
        </table>
      `
              : '<p style="color:var(--text-light);">No data yet</p>';
        } catch (e) {
          console.error(e);
        }
      }

      // ═══════════════════════════════════════════════════════════════════════
      //  CUSTOMERS
      // ═══════════════════════════════════════════════════════════════════════
      async function loadCustomers() {
        try {
          const res = await api("/admin/analytics/customers");
          const d = res.data;

          document.getElementById("customerSummary").innerHTML = `
        <div class="stat-card">
          <div class="stat-icon purple"><i class="fas fa-users"></i></div>
          <div class="stat-info"><h4>Total Customers</h4><div class="number">${d.total_customers}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green"><i class="fas fa-user-check"></i></div>
          <div class="stat-info"><h4>Active</h4><div class="number">${d.active_customers}</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon red"><i class="fas fa-user-times"></i></div>
          <div class="stat-info"><h4>Inactive</h4><div class="number">${d.total_customers - d.active_customers}</div></div>
        </div>
      `;

          // Sign-up chart
          const signups = d.daily_signups || [];
          const maxS = Math.max(...signups.map((s) => s.count), 1);
          document.getElementById("signupChart").innerHTML = signups
            .map((s) => {
              const h = Math.max((s.count / maxS) * 140, 4);
              return `<div class="chart-bar" style="height:${h}px;background:var(--info);"><span class="tooltip">${s.date}: ${s.count} new</span></div>`;
            })
            .join("");
          document.getElementById("signupLabels").innerHTML = signups
            .map((s, i) => {
              const show =
                signups.length <= 14 ||
                i % Math.ceil(signups.length / 14) === 0;
              return `<span>${show ? s.date.slice(5) : ""}</span>`;
            })
            .join("");

          // Top customers
          document.getElementById("topCustomersBody").innerHTML =
            (d.top_customers || [])
              .map(
                (c) => `
        <tr>
          <td style="font-weight:500;">${c.name}</td>
          <td>${c.email}</td>
          <td>${c.requests}</td>
          <td>${peso(c.total_spent)}</td>
        </tr>
      `,
              )
              .join("") ||
            '<tr><td colspan="4" style="text-align:center;padding:20px;">No customer data yet</td></tr>';
        } catch (e) {
          console.error(e);
        }
      }

      // ── Sidebar toggle (mobile) ─────────────────────────────────────────
      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
      }
      window.addEventListener("resize", () => {
        const toggle = document.getElementById("menuToggle");
        if (window.innerWidth <= 1024) toggle.style.display = "flex";
        else {
          toggle.style.display = "none";
          document.getElementById("sidebar").classList.remove("open");
        }
      });
      window.dispatchEvent(new Event("resize"));

      // ── Auto-start ──────────────────────────────────────────────────────
      (async function boot() {
        if (TOKEN) {
          try {
            await api("/admin/me");
            document.getElementById("loginOverlay").style.display = "none";
            initDashboard();
          } catch (e) {
            // Token invalid, show login
          }
        }
      })();
    </script>
  </body>
</html>
